<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>jsTree test</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <div id="jstree"></div>
  <!-- 2 load the theme CSS file -->
  <style>
      ul{
          list-style:none;
      }
     .d-n {
         display:none;
     }
     .toolBar {
        margin:0 1rem;
        float:right;
        color:#ccc;
        height:2rem;
        line-height:2rem;
        transition:all;
     }
     li:hover .toolBar {
        display:inline;
      }
      /*
      .expandBar:hover {
         transform: rotate(90deg);
      }*/
      .expandBar--expend{
          transform: rotate(90deg);
      }
      li span.hasChildren {
          display:inline-block;
          visibility:visible;
      }
      .expandBar {
          cursor:pointer;
          visibility: hidden;
          height:2rem;
          line-height:2rem;
      }
      span.text {
          cursor:pointer;
          height:2rem;
          line-height:2rem;
      }
      span.text--selected {
          background-color:#d5e8fc;
      }
      span.toolBar--enable {
          color:#000;
          cursor:pointer;
      }
      .editModal,.deleteModal {
          position:fixed;
          left:400px;
          right:400px;
          top:400px;
          bottom:400px;
      }
  </style>
  <link rel="stylesheet" href="dist/themes/default/style.min.css" />
</head>
<body>
        <div style="width:500px;" id="tree">
                <ul>
                    <li>
                       <span class="expandBar hasChildren glyphicon glyphicon-chevron-right"></span>
                       <span class="text">研发部</span>
                       <span class="toolBar glyphicon glyphicon-trash"></span>
                       <span class="toolBar glyphicon glyphicon-edit"></span>
                        <ul>
                            <li>
                                <span class="expandBar glyphicon glyphicon-chevron-right"></span>
                                <span class="text">基础研发组</span>
                                <span class="toolBar glyphicon glyphicon-trash"></span>
                                <span class="toolBar glyphicon glyphicon-edit"></span>
                            </li>
                            <li>
                                  <span class="expandBar glyphicon glyphicon-chevron-right"></span>
                                  <span class="text">应用研发组</span>
                                  <span class="toolBar glyphicon glyphicon-trash"></span>
                                  <span class="toolBar glyphicon glyphicon-edit"></span>
                            </li>
                            <li>
                                  <span class="expandBar glyphicon glyphicon-chevron-right"></span>
                                  <span class="text">技术支持组</span>
                                  <span class="toolBar glyphicon glyphicon-trash"></span>
                                  <span class="toolBar glyphicon glyphicon-edit"></span>
                            </li>
                        </ul>
                    </li>
                    <li>
                          <span class="expandBar glyphicon glyphicon-chevron-right"></span>
                          <span class="text">领导班子</span>
                          <span class="toolBar glyphicon glyphicon-trash"></span>
                          <span class="toolBar glyphicon glyphicon-edit"></span>
                    </li>
                    <li>
                          <span class="expandBar glyphicon glyphicon-chevron-right"></span>
                          <span class="text">综合部</span>
                          <span class="toolBar glyphicon glyphicon-trash"></span>
                          <span class="toolBar glyphicon glyphicon-edit"></span>
                    </li>
                </ul>
            </div>
            <div class="editModal d-n">
                部门名称:<input type="text" name="deptname" id="deptname"><br/>
                部门负责人:<input type="text" name="deptleader" id="deptleader" />
                <div><button class="cancel">取消</button><button class="submit">确认</button></div>
            </div>
            <div class="deleteModal d-n">
                <div>确认删除了么?</div>
                <div><button class="cancel">取消</button><button class="submit">确认</button></div>
            </div>
  <!-- 4 include the jQuery library -->
  <script src="dist/libs/jquery.js"></script>
  <!-- 5 include the minified jstree source -->
  <script src="dist/jstree.min.js"></script>
  <script>
 

  $("span.expandBar").click(function() {
      $(this).toggleClass("expandBar--expend");
      $(this).siblings("ul").toggleClass("d-n");
  });
  $("span.text").click(function() {
      if ($(this).hasClass("text--selected")) {
        $("#tree").find("span.text").removeClass("text--selected");
        $("#tree").find("span.toolBar").removeClass("toolBar--enable");
        return;
      }
      $("#tree").find("span.text").removeClass("text--selected");
      $("#tree").find("span.toolBar").removeClass("toolBar--enable");
      $(this).addClass("text--selected");
      $(this).siblings("span.toolBar").addClass("toolBar--enable");
  });
  $("span.toolBar.glyphicon-trash").click(function() {
      if ($(this).hasClass("toolBar--enable")) {
          //alert("删除弹窗!" + $(this).siblings("span.text").text());
          $(".deleteModal").removeClass("d-n");
      }
  });
  $("span.toolBar.glyphicon-edit").click(function() {
      if ($(this).hasClass("toolBar--enable")) {
          //alert("编辑弹窗!"+ $(this).siblings("span.text").text());
          $(".editModal").removeClass("d-n");
          $(".editModal input#deptname").val($(this).siblings("span.text").text());
      }
  });
  $(".editModal button.cancel").click(function() {
      $(this).parent().parent().addClass("d-n");
  })
  $(".deleteModal button.cancel").click(function() {
      $(this).parent().parent().addClass("d-n");
  })
  
  let data = [
      {
        id:1,
        name:"研发部"
      },
      {
        id:2,
        name:"领导班子"
      },
      {
        id:3,
        name:"综合部"
      },
      {
        id:4,
        pid:1,
        name:"基础研发组"
      },
      {
        id:5,
        pid:1,
        name:"应用研发组"
      },
      {
        id:6,
        pid:1,
        name:"技术支持组",

      }
  ]

 data1 = [
     {
        id:1,
        name:"空间公司研发中心",
    },
    {
        id:2,
        pid:1,
        name:"研发部"
    },
    {
        id:3,
        pid:1,
        name:"领导班子"
    },
    {
        id:4,
        pid:1,
        name:"研发部"
    },
    {
        id:5,
        pid:2,
        name:"基础研发组"
    },
    {
        id:6,
        pid:2,
        name:"应用研发组"
    },
    {
        id:7,
        pid:2,
        name:"技术支持组"
    },
 ];



    function renderTree(data) {
        resolveTreeData(data);
    }

    function resolveTreeData(data) {
        let parents = [];
        let parentIds = [];
        for (let i = 0,len = data.length;i < len;i++) {
            let e = data[i];
            if (!e.pid) {
                parents.push(e);
                parentIds.push(e.id);
                data.splice(i, 1);
                i--;
                len = data.length;
            }
        }
            
        resloveChildren(parents, parentIds, data);
        console.log(parents);
    }

    function resloveChildren(parents, parentIds, childrenData) {
        let nextParent = [];
        let nextParentIds = [];
        for (let i=0,len=childrenData.length;i<len;i++) {
            let e = childrenData[i];
            if (parentIds.indexOf(e.pid) > -1) {
                parents[parentIds.indexOf(e.pid)].children = parents[parentIds.indexOf(e.pid)].children || [];
                parents[parentIds.indexOf(e.pid)].children.push(e);
                nextParent.push(e);
                nextParentIds.push(e.id);
                childrenData.splice(i, 1);
                i--;
                len = childrenData.length;
            }
        }
        if (childrenData.length === 0) {
            return;
        } else {
            resloveChildren(nextParent, nextParentIds, childrenData)
        }
    }

console.log(renderTree(data1));





  function resolveSingleItem(item) {
      item.name =
                      `<li>
                          <span class="expandBar glyphicon glyphicon-chevron-right"></span>
                          <span class="text">综合部</span>
                          <span class="toolBar glyphicon glyphicon-trash"></span>
                          <span class="toolBar glyphicon glyphicon-edit"></span>
                      </li>`
  }

  </script>
</body>
</html>